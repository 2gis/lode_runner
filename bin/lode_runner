#!/usr/bin/env python
from sys import argv

from nose.core import TextTestResult, TextTestRunner, TestProgram


class LodeTestResult(TextTestResult):
    def printErrorList(self, flavour, errors):
        unicode_escaped_errors = []
        for test, _err in errors:
            try:
                error_str = str(_err)
            except UnicodeEncodeError:
                error = unicode(_err)
            else:
                # 'ignore': ignore malformed data and continue decoding without further notice
                error = error_str.decode(encoding='unicode-escape', errors='ignore')
            unicode_escaped_errors.append((test, error))
        super(LodeTestResult, self).printErrorList(flavour, unicode_escaped_errors)


class LodeRunner(TextTestRunner):
    def _makeResult(self):
        return LodeTestResult(
            self.stream,
            self.descriptions,
            self.verbosity,
            self.config
        )


if __name__ == '__main__':
    TestProgram(testRunner=LodeRunner(), exit=True, argv=argv)